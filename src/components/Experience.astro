---
import Education from "./Education.astro";

// Función para obtener proyectos desde Strapi
async function fetchProjects() {
  try {
    const STRAPI_URL = import.meta.env.STRAPI_URL || 'http://localhost:1337';
    const response = await fetch(`${STRAPI_URL}/api/proyectos?populate=*`);
    const data = await response.json();
    return data.data || [];
  } catch (error) {
    console.error('Error fetching projects:', error);
    return [];
  }
}

// Obtener proyectos desde Strapi
const projects = await fetchProjects();
---

<section id="experiencia" class="experience">
  <div class="container">
    <h2 class="section-title">Experiencia & Educación</h2>
    <p class="section-subtitle">Mi trayectoria profesional y académica</p>
    
    <!-- Experiencia Profesional -->
    <div class="section-container">
      <h3 class="section-category">Experiencia Profesional</h3>
      
      <div class="experience-cards">
        {projects.length > 0 ? (
          projects.map((project) => (
            <div class="experience-card">
              <div class="experience-image">
                <img 
                  src={project.imagen_principal?.url ? `${import.meta.env.STRAPI_URL || 'http://localhost:1337'}${project.imagen_principal.url}` : "/images/proyectos/default.png"} 
                  alt={project.titulo} 
                />
                <div class="experience-overlay"></div>
              </div>
              <div class="experience-content">
                <span class="date">{project.ano_creacion || new Date(project.createdAt).getFullYear() || new Date().getFullYear()}</span>
                <h4 class="title">{project.titulo}</h4>
                <p class="description">
                  {project.descripcion}
                </p>
                <div class="experience-footer">
                  <div class="project-links">
                    {project.enlace_github && (
                      <a href={project.enlace_github} class="project-link" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                        </svg>
                        GitHub
                      </a>
                    )}
                    {project.enlace_demo && (
                      <a href={project.enlace_demo} class="project-link demo-link" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                          <polyline points="15,3 21,3 21,9"></polyline>
                          <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                        Demo
                      </a>
                    )}
                  </div>
                  <div class="tags">
                    {project.tecnologias && project.tecnologias.map((tech) => (
                      <span class="tag">{tech}</span>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          ))
        ) : (
          <!-- Fallback content if no projects are available -->
          <div class="experience-card">
            <div class="experience-image">
              <img src="/images/proyectos/clinica-miel.png" alt="Clínica de Rehabilitación" />
              <div class="experience-overlay"></div>
            </div>
            <div class="experience-content">
              <span class="date">2025</span>
              <h4 class="title">Desarrollo de Sitio Web para Clínica de Rehabilitación</h4>
              <p class="description">
                Trabajé en equipo para desarrollar un sitio web completo para una clínica de rehabilitación, 
                enfocado en la reservación de citas. El proyecto incluyó el diseño de interfaz de usuario, 
                implementación de sistema de reservas y gestión de base de datos.
              </p>
              <div class="experience-footer">
                <div class="project-links">
                  <a href="https://github.com/JuanCarlos0511/proyecto_udm" class="project-link" target="_blank" rel="noopener noreferrer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                    </svg>
                    GitHub
                  </a>
                </div>
                <div class="tags">
                  <span class="tag">HTML/CSS</span>
                  <span class="tag">JavaScript</span>
                  <span class="tag">PHP</span>
                  <span class="tag">MySQL</span>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
    
    <!-- Componente de Educación -->
    <Education />
  </div>
  
  <div class="experience-background">
    <div class="circle circle-1"></div>
    <div class="circle circle-2"></div>
  </div>
</section>

<style>
  .experience {
    background-color: var(--background-color);
    position: relative;
    padding: 5rem 0;
    overflow: hidden;
  }
  
  .experience-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
  }
  
  .circle {
    position: absolute;
    border-radius: 50%;
    filter: blur(60px);
    opacity: 0.15;
  }
  
  .circle-1 {
    width: 400px;
    height: 400px;
    background-color: var(--primary-color);
    top: 10%;
    right: -150px;
  }
  
  .circle-2 {
    width: 300px;
    height: 300px;
    background-color: var(--secondary-color);
    bottom: 15%;
    left: -100px;
  }

  .section-subtitle {
    text-align: center;
    color: var(--text-color);
    opacity: 0.8;
    font-size: 1.1rem;
    margin-bottom: 3rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .section-container {
    position: relative;
    z-index: 1;
    max-width: 1000px;
    margin: 0 auto 4rem;
  }
  
  .section-category {
    font-size: 1.8rem;
    margin: 2.5rem 0 1.5rem 0;
    color: var(--primary-color);
    position: relative;
    text-align: center;
    padding-bottom: 1rem;
  }
  
  .section-category::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 3px;
    background-color: var(--accent-color);
    border-radius: 3px;
  }
  
  /* Estilos para tarjetas de experiencia profesional */
  .experience-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }
  
  .experience-card {
    background: linear-gradient(145deg, rgba(74, 59, 145, 0.1), rgba(106, 90, 205, 0.1));
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(106, 90, 205, 0.2);
    transform: translateY(0);
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.5s ease;
  }
  
  .experience-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
  }
  
  .experience-image {
    position: relative;
    height: 200px;
    overflow: hidden;
  }
  
  .experience-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  
  .experience-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, transparent, rgba(18, 18, 18, 0.4));
  }
  
  .experience-card:hover .experience-image img {
    transform: scale(1.05);
  }
  
  .experience-content {
    padding: 1.5rem;
  }
  
  .experience-footer {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .date {
    display: inline-block;
    padding: 0.3rem 1rem;
    background-color: var(--primary-color);
    color: white;
    border-radius: 20px;
    font-size: 0.9rem;
    margin-bottom: 0.8rem;
  }
  
  .title {
    font-size: 1.3rem;
    margin-bottom: 0.8rem;
    color: var(--text-color);
    line-height: 1.4;
  }
  
  .description {
    color: rgba(248, 248, 255, 0.8);
    margin-bottom: 1rem;
    font-size: 0.95rem;
    line-height: 1.6;
  }
  
  .institution {
    color: var(--accent-color);
    font-weight: 500;
    margin-bottom: 0.8rem;
    font-size: 1rem;
  }
  
  .project-links {
    display: flex;
    gap: 1rem;
  }
  
  .project-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background-color: rgba(106, 90, 205, 0.3);
    color: var(--text-color);
    border-radius: 20px;
    font-size: 0.9rem;
    text-decoration: none;
    transition: all 0.3s ease;
  }
  
  .project-link:hover {
    background-color: var(--primary-color);
    transform: translateY(-3px);
    color: white;
  }
  
  .project-link svg {
    width: 1rem;
    height: 1rem;
  }
  
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .tag {
    padding: 0.3rem 1rem;
    background-color: rgba(106, 90, 205, 0.2);
    border-radius: 20px;
    font-size: 0.8rem;
    color: var(--text-color);
  }
  
  @media (max-width: 992px) {
    .experience-card {
      width: 100%;
    }
  }
  
  @media (max-width: 768px) {
    .experience-cards {
      grid-template-columns: 1fr;
    }
  }
  
  @media (max-width: 480px) {
    .experience-card {
      padding: 0;
    }
    
    .experience-content {
      padding: 1.2rem;
    }
    
    /* Mejorar espaciado para dispositivos móviles */
    .section-container {
      margin-bottom: 2rem;
    }
    
    /* Mejorar espacio para el componente Education */
    .experience-section + .education-section {
      margin-top: 0;
      padding-top: 0;
    }
  }
  
  /* Animación de aparición para las tarjetas de experiencia */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .experience-card {
    animation: fadeInUp 0.8s ease-out forwards;
  }
  
  .experience-card:nth-child(2) {
    animation-delay: 0.3s;
  }

  .demo-link {
    background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
  }

  .demo-link:hover {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    transform: translateY(-2px);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Animación al hacer scroll para que los elementos aparezcan
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, {
      threshold: 0.1
    });
    
    document.querySelectorAll('.experience-card').forEach(card => {
      observer.observe(card);
    });
    
    // Efecto de elevación al pasar el mouse sobre las tarjetas de experiencia
    document.querySelectorAll('.experience-card').forEach(card => {
      card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-15px) scale(1.02)';
        card.style.boxShadow = '0 20px 40px rgba(0, 0, 0, 0.2)';
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'translateY(0) scale(1)';
        card.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.1)';
      });
    });
    
    // Detectar si estamos en móvil y ajustar los espacios entre secciones
    const adjustMobileSpacing = () => {
      const isMobile = window.innerWidth <= 768;
      
      if (isMobile) {
        // Ajustar espacios entre las secciones en móvil
        const educationSection = document.querySelector('.education-section');
        if (educationSection) {
          educationSection.style.marginTop = '2rem';
          educationSection.style.paddingTop = '0';
        }
      }
    };
    
    // Ejecutar al cargar y al cambiar el tamaño de la ventana
    adjustMobileSpacing();
    window.addEventListener('resize', adjustMobileSpacing);
  });
</script>
